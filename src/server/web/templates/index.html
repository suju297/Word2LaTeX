<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Word to LaTeX Forge</title>
  <meta name="description" content="Convert DOCX to editable LaTeX with layout-aware hints.">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link
    href="https://fonts.googleapis.com/css2?family=Fraunces:opsz,wght@9..144,400;9..144,600&family=Space+Grotesk:wght@400;600;700&display=swap"
    rel="stylesheet"
  >
  <style>
    :root {
      --bg: #f6f1e8;
      --bg-deep: #e7dcc8;
      --ink: #1a1916;
      --muted: #5b5246;
      --accent: #e0722a;
      --accent-2: #2a7f7b;
      --card: #fff9f0;
      --line: rgba(26, 25, 22, 0.12);
      --shadow: 0 20px 60px rgba(26, 25, 22, 0.14);
    }

    * {
      box-sizing: border-box;
    }

    body {
      margin: 0;
      min-height: 100vh;
      color: var(--ink);
      background:
        radial-gradient(60% 120% at 8% 10%, #fff0d6 0%, rgba(255, 240, 214, 0) 60%),
        radial-gradient(50% 90% at 92% 12%, #d8efe6 0%, rgba(216, 239, 230, 0) 58%),
        linear-gradient(180deg, var(--bg) 0%, var(--bg-deep) 100%);
      font-family: "Fraunces", "Georgia", serif;
    }

    .page {
      max-width: 1120px;
      margin: 0 auto;
      padding: 48px 24px 60px;
    }

    .hero {
      display: flex;
      flex-direction: column;
      gap: 12px;
      margin-bottom: 36px;
      animation: fadeUp 0.8s ease both;
    }

    .hero h1 {
      font-family: "Space Grotesk", "Trebuchet MS", sans-serif;
      font-size: clamp(2.6rem, 4vw, 4rem);
      letter-spacing: -0.02em;
      margin: 0;
    }

    .hero p {
      margin: 0;
      max-width: 640px;
      color: var(--muted);
      font-size: 1.05rem;
    }

    .stats {
      display: grid;
      grid-template-columns: repeat(2, minmax(0, 1fr));
      gap: 16px;
      margin-top: 20px;
    }

    .stat {
      background: rgba(255, 255, 255, 0.7);
      border-radius: 18px;
      padding: 16px 18px;
      border: 1px solid rgba(26, 25, 22, 0.08);
      box-shadow: 0 12px 28px rgba(26, 25, 22, 0.08);
    }

    .stat-value {
      font-family: "Space Grotesk", "Trebuchet MS", sans-serif;
      font-size: clamp(1.6rem, 3vw, 2.4rem);
      font-weight: 700;
    }

    .stat-label {
      text-transform: uppercase;
      letter-spacing: 0.18em;
      font-size: 0.7rem;
      color: var(--muted);
      margin-top: 6px;
      font-family: "Space Grotesk", "Trebuchet MS", sans-serif;
    }

    .hero .tag {
      font-family: "Space Grotesk", "Trebuchet MS", sans-serif;
      text-transform: uppercase;
      letter-spacing: 0.2em;
      font-size: 0.75rem;
      color: var(--accent-2);
    }

    .layout {
      display: grid;
      grid-template-columns: minmax(0, 1.1fr) minmax(0, 0.9fr);
      gap: 28px;
      align-items: start;
    }

    .card {
      background: var(--card);
      border-radius: 24px;
      padding: 28px;
      box-shadow: var(--shadow);
      position: relative;
      overflow: hidden;
      animation: fadeUp 0.9s ease both;
      animation-delay: 0.1s;
    }

    .card::before {
      content: "";
      position: absolute;
      inset: 0;
      border-radius: 24px;
      padding: 1px;
      background: linear-gradient(120deg, rgba(224, 114, 42, 0.6), rgba(42, 127, 123, 0.5));
      -webkit-mask:
        linear-gradient(#fff 0 0) content-box,
        linear-gradient(#fff 0 0);
      -webkit-mask-composite: xor;
      mask-composite: exclude;
      pointer-events: none;
    }

    form {
      display: grid;
      gap: 18px;
    }

    .field {
      display: grid;
      gap: 8px;
    }

    label {
      font-family: "Space Grotesk", "Trebuchet MS", sans-serif;
      font-weight: 600;
      letter-spacing: 0.01em;
    }

    input[type="file"],
    input[type="text"],
    select {
      font-family: "Space Grotesk", "Trebuchet MS", sans-serif;
      padding: 10px 12px;
      border-radius: 12px;
      border: 1px solid var(--line);
      background: #fff;
    }

    .hint {
      font-size: 0.9rem;
      color: var(--muted);
      margin: 0;
    }

    details {
      border: 1px dashed rgba(26, 25, 22, 0.2);
      border-radius: 16px;
      padding: 14px 16px;
      background: rgba(255, 255, 255, 0.4);
    }

    summary {
      cursor: pointer;
      font-family: "Space Grotesk", "Trebuchet MS", sans-serif;
      font-weight: 600;
    }

    .options {
      display: grid;
      gap: 12px;
      margin-top: 12px;
    }

    .checkbox {
      display: flex;
      gap: 10px;
      align-items: center;
      font-family: "Space Grotesk", "Trebuchet MS", sans-serif;
    }

    .actions {
      display: flex;
      flex-wrap: wrap;
      gap: 12px;
      align-items: center;
    }

    button {
      font-family: "Space Grotesk", "Trebuchet MS", sans-serif;
      border-radius: 999px;
      border: none;
      padding: 12px 20px;
      font-weight: 600;
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 10px;
      transition: transform 0.2s ease, box-shadow 0.2s ease, background 0.2s ease;
    }

    button.primary {
      background: linear-gradient(120deg, var(--accent), #f29b57);
      color: #fff;
      box-shadow: 0 14px 30px rgba(224, 114, 42, 0.3);
    }

    button.ghost {
      background: transparent;
      border: 1px solid var(--line);
      color: var(--ink);
    }

    button:disabled {
      cursor: not-allowed;
      opacity: 0.7;
    }

    button.primary.loading {
      color: rgba(255, 255, 255, 0.75);
    }

    .btn-spinner {
      width: 14px;
      height: 14px;
      border-radius: 50%;
      border: 2px solid rgba(255, 255, 255, 0.45);
      border-top-color: #fff;
      opacity: 0;
      transform: scale(0.6);
      transition: opacity 0.2s ease, transform 0.2s ease;
    }

    button.primary.loading .btn-spinner {
      opacity: 1;
      transform: scale(1);
      animation: spin 0.7s linear infinite;
    }

    button:hover:not(:disabled) {
      transform: translateY(-1px);
      box-shadow: 0 16px 32px rgba(26, 25, 22, 0.18);
    }

    .status {
      min-height: 24px;
      font-family: "Space Grotesk", "Trebuchet MS", sans-serif;
      padding: 12px 14px;
      border-radius: 14px;
      border: 1px solid transparent;
      opacity: 0;
      transform: translateY(8px);
      transition: opacity 0.2s ease, transform 0.2s ease;
    }

    .status.show {
      opacity: 1;
      transform: translateY(0);
    }

    .status[data-tone="info"] {
      background: rgba(42, 127, 123, 0.12);
      border-color: rgba(42, 127, 123, 0.3);
      color: #1c5552;
    }

    .status[data-tone="error"] {
      background: rgba(209, 79, 52, 0.12);
      border-color: rgba(209, 79, 52, 0.3);
      color: #8b2e1b;
    }

    .status[data-tone="success"] {
      background: rgba(78, 130, 70, 0.12);
      border-color: rgba(78, 130, 70, 0.3);
      color: #2f5d2c;
    }

    .side {
      background: rgba(255, 255, 255, 0.55);
      border-radius: 24px;
      padding: 24px;
      border: 1px solid rgba(26, 25, 22, 0.08);
      box-shadow: 0 18px 40px rgba(26, 25, 22, 0.08);
      animation: fadeUp 0.9s ease both;
      animation-delay: 0.2s;
    }

    .side h2 {
      font-family: "Space Grotesk", "Trebuchet MS", sans-serif;
      margin-top: 0;
    }

    .side ul {
      padding-left: 18px;
      color: var(--muted);
    }

    .badge {
      display: inline-flex;
      margin-top: 16px;
      padding: 8px 14px;
      border-radius: 999px;
      background: rgba(224, 114, 42, 0.14);
      color: #7a3f17;
      font-family: "Space Grotesk", "Trebuchet MS", sans-serif;
      font-weight: 600;
    }

    footer {
      margin-top: 36px;
      color: var(--muted);
      font-size: 0.9rem;
      display: flex;
      justify-content: space-between;
      flex-wrap: wrap;
      gap: 12px;
    }

    @keyframes fadeUp {
      from {
        opacity: 0;
        transform: translateY(16px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    @keyframes spin {
      from {
        transform: rotate(0deg);
      }
      to {
        transform: rotate(360deg);
      }
    }

    @media (max-width: 960px) {
      .layout {
        grid-template-columns: 1fr;
      }

      .page {
        padding: 36px 18px 48px;
      }

      .stats {
        grid-template-columns: 1fr;
      }
    }

    @media (prefers-reduced-motion: reduce) {
      * {
        animation-duration: 0.001ms !important;
        animation-iteration-count: 1 !important;
        transition-duration: 0.001ms !important;
      }
    }
  </style>
</head>
<body>
  <div class="page">
    <header class="hero">
      <div class="tag">Word to LaTeX</div>
      <h1>Forge polished LaTeX from DOCX files.</h1>
      <p>Upload a Word document to get a clean, editable LaTeX file.</p>
      <div class="stats">
        <div class="stat">
          <div class="stat-value" id="stat-visitors">{{ visitor_count }}</div>
          <div class="stat-label">Visitors</div>
        </div>
        <div class="stat">
          <div class="stat-value" id="stat-conversions">{{ conversion_count }}</div>
          <div class="stat-label">Conversions</div>
        </div>
      </div>
    </header>

    <main class="layout">
      <section class="card">
        <form id="convert-form">
          <div class="field">
            <label for="docx">DOCX file</label>
            <input id="docx" name="docx" type="file" accept=".docx" required>
          </div>


          <div class="actions">
            <button id="submit-btn" type="submit" class="primary">
              <span class="btn-label">Convert to LaTeX</span>
              <span class="btn-spinner" aria-hidden="true"></span>
            </button>
            <button id="clear-btn" type="button" class="ghost">Reset</button>
          </div>
        </form>

        <div class="status" id="status" role="status" aria-live="polite"></div>
      </section>

      <aside class="side">
        <h2>What to expect</h2>
        <ul>
          <li>ZIP download containing an editable .tex file (plus images if needed).</li>
          <li>Structure-preserving conversion for resumes and reports.</li>
          <li>Compile with XeLaTeX or LuaLaTeX (Overleaf: switch compiler).</li>
          <li>Per-IP cooldown: {{ cooldown_minutes }} minutes between conversions.</li>
          <li>No login required.</li>
        </ul>
        <div class="badge">Built for fast iteration</div>
      </aside>
    </main>

    <footer>
      <div>Get a clean ZIP with your .tex in seconds.</div>
      <div>Questions or feedback? Reach out.</div>
    </footer>
  </div>

  <script>
    const form = document.getElementById("convert-form");
    const statusEl = document.getElementById("status");
    const submitBtn = document.getElementById("submit-btn");
    const clearBtn = document.getElementById("clear-btn");

    const docxInput = document.getElementById("docx");
    const visitorsStat = document.getElementById("stat-visitors");
    const conversionsStat = document.getElementById("stat-conversions");

    const setStatus = (message, tone) => {
      statusEl.textContent = message;
      statusEl.dataset.tone = tone;
      statusEl.classList.add("show");
    };

    const clearStatus = () => {
      statusEl.textContent = "";
      statusEl.classList.remove("show");
    };

    const setBusy = (busy) => {
      submitBtn.disabled = busy;
      submitBtn.classList.toggle("loading", busy);
    };

    const formatRetry = (raw) => {
      const seconds = Number.parseInt(raw, 10);
      if (!Number.isFinite(seconds)) {
        return "a bit";
      }
      if (seconds < 90) {
        return seconds === 1 ? "1 second" : `${seconds} seconds`;
      }
      const minutes = Math.ceil(seconds / 60);
      return minutes === 1 ? "1 minute" : `${minutes} minutes`;
    };

    const updateStats = (data) => {
      const visitorCount = Number(data.visitor_count);
      const conversionCount = Number(data.conversion_count);
      if (visitorsStat && Number.isFinite(visitorCount)) {
        visitorsStat.textContent = visitorCount;
      }
      if (conversionsStat && Number.isFinite(conversionCount)) {
        conversionsStat.textContent = conversionCount;
      }
    };

    const refreshStats = async () => {
      try {
        const response = await fetch("/stats");
        if (!response.ok) {
          return;
        }
        const data = await response.json();
        updateStats(data);
      } catch (error) {
        return;
      }
    };

    form.addEventListener("submit", async (event) => {
      event.preventDefault();
      clearStatus();

      const docxFile = docxInput.files[0];
      if (!docxFile) {
        setStatus("Please select a DOCX file.", "error");
        return;
      }

      const formData = new FormData();
      formData.append("docx", docxFile);

      setBusy(true);
      setStatus("Working on it. This can take a bit.", "info");

      try {
        const response = await fetch("/v1/convert", {
          method: "POST",
          body: formData,
        });

        if (!response.ok) {
          let message = "Conversion failed.";
          try {
            const data = await response.json();
            message = data.message || data.detail || message;
          } catch (error) {
            message = "Conversion failed with a server error.";
          }

          if (response.status === 429) {
            const retryAfter = response.headers.get("Retry-After");
            if (retryAfter) {
              message = `Rate limit exceeded. Try again in ${formatRetry(retryAfter)}.`;
            }
          }

          setStatus(message, "error");
          return;
        }

        const blob = await response.blob();
        const baseName = docxFile.name.replace(/\.docx$/i, "");
        const contentType = response.headers.get("content-type") || "";
        const disposition = response.headers.get("content-disposition") || "";
        let filename = "";
        const match = disposition.match(/filename=\"?([^\";]+)\"?/i);
        if (match && match[1]) {
          filename = match[1];
        } else if (contentType.includes("zip")) {
          filename = baseName ? `${baseName}.zip` : "wordtolatex_output.zip";
        } else {
          filename = baseName ? `${baseName}.zip` : "wordtolatex_output.zip";
        }
        const url = URL.createObjectURL(blob);
        const link = document.createElement("a");
        link.href = url;
        link.download = filename;
        document.body.appendChild(link);
        link.click();
        link.remove();
        URL.revokeObjectURL(url);

        setStatus("File ready. Check your downloads.", "success");
        refreshStats();
      } catch (error) {
        setStatus("Network error. Please try again.", "error");
      } finally {
        setBusy(false);
      }
    });

    clearBtn.addEventListener("click", () => {
      form.reset();
      clearStatus();
    });

    refreshStats();
    setInterval(refreshStats, 15000);
  </script>
</body>
</html>
